+++
title='Пишите маленькие функции на основе примеров'
date=2024-07-10T00:00:00-07:00
draft=true
categories=[]
tags=[]
cover_image='/images/cover/knoxwelle__2021-08-08T051054.000Z.jpg'
+++
Кейт Брэйтуэйт
Мы хо­тим пи­сать пра­виль­ный код и иметь на руках свидетельство его правильности. В обоих случаях будет полезным принять во внимание «размер» функции. Не в смысле объема кода, который реализует функцию – хотя и это интересно, – а как размер математической функции, которую демонстрирует наш код.
Например, в игре го есть положение, называемое атари, в котором фишки игрока могут быть захвачены противником: фишка с двумя и более свободными соседними клетками (называемыми степенями свободы), не находится в положении атари. Подсчитать количество степеней свободы у фишки бывает нелегко, 
но, когда оно известно, определить атари легко. Можно для начала написать такую функцию:
boolean atari(int libertyCount)
 libertyCount < 2
Здесь спрятано больше, чем кажется на первый взгляд. Математическую функцию можно рассматривать как множество – некоторое подмножество декартова 
произведения области определения (здесь это int) и области принимаемых значений (здесь – boolean). Будь эти множества одинакового размера, как в Java, в множестве int×boolean было бы 2L*(Integer.MAX_VALUE+(–1L*Integer.MIN_VALUE)+1L), или 
8589934592 элементов. Половина из них принадлежит подмножеству, являющемуся нашей функцией, поэтому для полного доказательства корректности нашей функции нужно проверить около 4,3×109 случаев.
На этом и основывается утверждение, что тестами нельзя доказать отсутствие 
дефектов. Тесты способны продемонстрировать, что функциональность реализована. Но проблема размера сохраняется.
Выход подсказывает предметная область. Природа го такова, что число степеней 
свободы фишки является не любым целым числом, а одним из чисел {1,2,3,4}. 
Поэтому можно написать другой вариант кода:

LibertyCount = {1,2,3,4}
boolean atari(LibertyCount libertyCount)
 libertyCount == 1
Это уже гораздо легче поддается обработке: вычисляемая функция – это множество, в котором максимум восемь элементов. Фактически проверка четырех случаев может дать полную уверенность, что функция корректна. Это одна из причин, почему при написании программ лучше использовать типы, тесно связанные с предметной областью, а не встроенные типы языка. Использование предметно-ориентированных типов часто позволяет значительно уменьшить размер 
функций. Один из способов выяснить, какими должны быть эти типы, – это 
найти примеры и определить термины предметной области до того, как писать 
функцию.